!function(e){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("jquery"),require("knockout"),exports):"function"==typeof define&&define.amd?define(["jquery","knockout","exports"],e):e(jQuery,ko,ko.validate={})}(function(e,a,t){if("undefined"==typeof a)throw new Error("Knockout is required, please ensure it is loaded before loading this validation plug-in");a.validate=t,a.validate.utils=function(){return{getBindingHandlerValue:function(e,a){return a().hasOwnProperty("value")?a().value:a().hasOwnProperty("textInput")?a().textInput:a().hasOwnProperty("checked")?a().checked:void 0},isArray:function(e){return e.isArray||"[object Array]"===Object.prototype.toString.call(e)},getValue:function(e){return a.utils.unwrapObservable(e)},hasAttribute:function(e,a){return null!==e.getAttribute(a)},getAttribute:function(e,a){return e.getAttribute(a)},setAttribute:function(e,a,t){return e.setAttribute(a,t)},isEmptyVal:function(e){return void 0===e?!0:null===e?!0:""===e?!0:void 0}}}();var r={useRequiredMarker:!0,classElementError:"error",classMessageError:"error-message",classHasRequired:"has-required",classHasError:"has-error",classGroupContainer:"form-group",appendMessageToContainer:!1},i=a.utils.extend({},r);a.validate.utils.resetConfig=function(){a.utils.extend(i,r)},a.validate.configuration=i,a.validate.rules={},a.validate.rules.required={validator:function(e,a){var t;return void 0===e||null===e?!a:(t=e,"string"==typeof e&&(t=String.prototype.trim?e.trim():e.replace(/^\s+|\s+$/g,"")),a?(t+"").length>0:!0)},message:"Obrigatório"},a.validate.rules.email={validator:function(e,t){return t?a.validate.utils.isEmptyVal(e)||t&&/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(e):!0},message:"Endereço de e-mail inválido"},a.validate.rules.cpf={message:"CPF inválido.",validator:function(e,t){if(a.validate.utils.isEmptyVal(e))return!0;var r,i,s,n,l,o;if(e=e.replace(/(\.)|(\-)|(\/)/g,""),o=1,e.length<11)return!1;for(n=0;n<e.length-1;n++)if(e.charAt(n)!=e.charAt(n+1)){o=0;break}if(o)return!1;for(r=e.substring(0,9),i=e.substring(9),s=0,n=10;n>1;n--)s+=r.charAt(10-n)*n;if(l=2>s%11?0:11-s%11,l!=i.charAt(0))return!1;for(r=e.substring(0,10),s=0,n=11;n>1;n--)s+=r.charAt(11-n)*n;return l=2>s%11?0:11-s%11,l!=i.charAt(1)?!1:!0}},a.validate.rules.cnpj={message:"CNPJ inválido.",validator:function(e,t){if(a.validate.utils.isEmptyVal(e))return!0;var r,i,s,n,l,o,u,d;if(e=e.replace(/(\.)|(\-)|(\/)/g,""),d=1,e.length<14&&e.length<15)return!1;for(n=0;n<e.length-1;n++)if(e.charAt(n)!=e.charAt(n+1)){d=0;break}if(d)return!1;for(u=e.length-2,r=e.substring(0,u),i=e.substring(u),s=0,o=u-7,n=u;n>=1;n--)s+=r.charAt(u-n)*o--,2>o&&(o=9);if(l=2>s%11?0:11-s%11,l!=i.charAt(0))return!1;for(u+=1,r=e.substring(0,u),s=0,o=u-7,n=u;n>=1;n--)s+=r.charAt(u-n)*o--,2>o&&(o=9);return l=2>s%11?0:11-s%11,l!=i.charAt(1)?!1:!0}},a.validate.rules.validarUsuario={valid:!1,message:"Nome de usuário já existe, escolha outro nome.",validator:function(t,r){return a.validate.utils.isEmptyVal(t)?!0:void a.computed(function(){e.ajax({url:"/Seguranca/Usuario/ValidarDuplicado",data:{login:a.utils.unwrapObservable(t),idPessoa:a.utils.unwrapObservable(r)},async:!1}).success(function(e){a.validate.rules.validarUsuario.valid=e.Sucesso})})}},a.validate.rules.inscricaoEstadual={message:"Inscrição Estadual inválida.",validator:function(e,t){return t?a.validate.utils.isEmptyVal(value)?!0:void 0:!0}},a.validate.rules.date={validator:function(e,t){return t?a.validate.utils.isEmptyVal(e)||t&&!/Invalid|NaN/.test(new Date(e)):!0},message:"Data inválida"},a.validate.rules.dateISO={validator:function(e,t){return t?a.validate.utils.isEmptyVal(e)||t&&/^\d{4}[-/](?:0?[1-9]|1[012])[-/](?:0?[1-9]|[12][0-9]|3[01])$/.test(e):!0},message:"Data inválida"},a.validate.rules.number={validator:function(e,t){return t?a.validate.utils.isEmptyVal(e)||t&&/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(e):!0},message:"Insira somente números"},a.validate.rules.digit={validator:function(e,t){return t?a.validate.utils.isEmptyVal(e)||t&&/^\d+$/.test(e):!0},message:"Insira somente dígitos"},a.validate.rules.cep={validator:function(e,t){return t?a.validate.utils.isEmptyVal(e)?!0:(e=e.replace(/\D/g,""),8===e.length):!0},message:"CEP inválido"},a.validate.rules.phone={validator:function(e,t){return t?a.validate.utils.isEmptyVal(e)?!0:(e=e.replace(/\D/g,""),11===e.length||10===e.length):!0},message:"Telefone inválido"},a.validate.rules.phoneUS={validator:function(e,t){return t?a.validate.utils.isEmptyVal(e)?!0:"string"!=typeof e?!1:(e=e.replace(/\s+/g,""),t&&e.length>9&&e.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/)):!0},message:"Telefone inválido"},a.validate.rules.equal={validator:function(e,t){var r=t;return a.validate.utils.isEmptyVal(e)&&a.validate.utils.isEmptyVal(r)?!0:e===a.validate.utils.getValue(r)},message:"Valores devem ser iguais"},a.validate.rules.notEqual={validator:function(e,t){var r=t;return a.validate.utils.isEmptyVal(e)&&a.validate.utils.isEmptyVal(r)?!0:e!==a.validate.utils.getValue(r)},message:"Valores não podem ser iguais"},a.validate.setValidationProperties=function(t){var r=function(){var t=this;this.invalidFields=a.observableArray([]),this.isValid=a.computed(function(){return 0===t.invalidFields().length}),this.isValidShowErrors=function(){return t.isValid()?!0:(t.showErrors(!0),!1)},this.showErrors=function(r){void 0===r&&(r=!0),a.utils.arrayForEach(t.invalidFields(),function(a,t){var r=e("#"+a),i=r.data("options"),s=r.closest("."+i.classGroupContainer).addClass(i.classHasError);r.addClass(i.classElementError),i.appendMessageToContainer?s.find("."+i.classMessageError).show():r.next().show(),0===t&&(r.is(":visible")?r.focus():s[0].scrollIntoView({behavior:"smooth"}))})}};a.utils.extend(t,new r)},a.bindingHandlers.validateOptions=function(){return{init:function(e,t,r,i,s){var n=a.utils.unwrapObservable(t()),l=s.extend({validateOptions:n});return a.applyBindingsToDescendants(l,e),{controlsDescendantBindings:!0}}}}(),a.bindingHandlers.validate={init:function(t,r,i,s,n){var l=a.validate.utils.getBindingHandlerValue(r,i),s=n.$component?n.$component:s,o=n.hasOwnProperty("validateOptions")?e.extend(!0,a.validate.configuration,n.validateOptions):a.validate.configuration,t=e(t),u=function(e){s.invalidFields.remove(e)},d=function(e){e.closest("."+o.classGroupContainer).addClass(o.classHasRequired)},c=function(e){e.closest("."+o.classGroupContainer).removeClass(o.classHasRequired)},v=function(e,a){o.appendMessageToContainer?e.closest("."+o.classGroupContainer).find("."+o.classMessageError).text(a):e.next().text(a)},p=function(e){s.invalidFields.push(e)},F=function(e){var a=e.closest("."+o.classGroupContainer);a.removeClass(o.classHasError),e.removeClass(o.classElementError),o.appendMessageToContainer?a.find("."+o.classMessageError).hide():e.next().hide()},f=function(e,a){var t=e.closest("."+o.classGroupContainer);t.addClass(o.classHasError),e.addClass(o.classElementError),o.appendMessageToContainer?t.find("."+o.classMessageError).show():e.next().show()},g=function(e,t){var r=!0,i=[],s="",n=!1;e.hasOwnProperty("rules")&&(e=e.rules);for(var l in e)if("value"!==l)if(a.validate.rules[l]){var o=a.validate.rules[l],s=e[l],u=o.validator(t,a.utils.unwrapObservable(s));"required"===l&&(n=s),o.hasOwnProperty("valid")&&(u=o.valid),u||(i.push(null!==e[l]&&e[l].hasOwnProperty("message")?e[l].message:o.message),r=!1)}else console&&console.error('ValidateWarning: The rule "'+l+'" is not defined, check the rules defined ->',a.validate.rules);return{messages:i,valid:r,hasRequiredRule:n}};return void 0===l?void(console&&console.error('ValidateError: Missing "value" bind parameter. Should be a "value", "textInput", "checked" or a "value" parameter inside the validate handler (validate: { value: observable, required: true })',t)):(o.appendMessageToContainer?e('<span class="'+o.classMessageError+'" style="display: none"></span>').appendTo(t.closest("."+o.classGroupContainer)):e('<span class="'+o.classMessageError+'" style="display: none"></span>').insertAfter(t),t.data("options",o),o.hasOwnProperty("appendErrorsToRoot")&&o.appendErrorsToRoot&&(s=n.$root),s.hasOwnProperty("isValid")||a.validate.setValidationProperties(s,o),void a.computed(function(){var e=a.utils.unwrapObservable(l),i=a.computedContext.isInitial(),s={},n=t.attr("id");if(0===n.length)throw console&&console.error(t),"ValidateError: Element to validate must have an ID";s=g(r(),e),v(t,s.messages.join(". ")),s.hasRequiredRule?d(t):c(t),s.valid?(u(n),F(t)):(p(n),i||s.hasRequiredRule||f(t))}))},update:function(e,a,t,r,i){}},a.bindingHandlers.validateForm={init:function(a,t,r,i,s){if("FORM"!==a.nodeName)throw"ValidateError: This validateForm handler should be used on a form element";var n=t();if(a.setAttribute("novalidate","novalidate"),$el=e(a),n.hasOwnProperty("submitHandler")){var l=function(){i.isValid()?n.submitHandler():i.showErrors()};$el.on("keydown",function(e){if(13===e.keyCode&&"TEXTAREA"!=e.target.tagName){if(e.target.classList.contains("modal"))return;e.target.blur(),l(),e.stopPropagation(),e.preventDefault()}}),$el.on("submit",function(e){document.activeElement.blur(),e.stopPropagation(),e.preventDefault(),l()})}}},a.applyBindingsWithValidation=function(e,t,r){a.validate.setValidationProperties(e,r),a.applyBindings(e,t)}});